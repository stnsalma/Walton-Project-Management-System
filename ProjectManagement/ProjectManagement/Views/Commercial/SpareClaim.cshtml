@using System.Diagnostics
@using System.Web.Mvc.Html
@model ProjectManagement.Models.SpareClaimModel
@{

    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/icheck/skins/all.css" rel="stylesheet" />
<link href="~/Content/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" />
<script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script src="~/Content/bootstrap-fileinput/bootstrap-fileinput.js"></script>
<script src="~/Content/icheck/icheck.min.js"></script>
<script src="~/Scripts/moment.js"></script>

<script src="~/Content/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
<link href="~/Content/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />

@*datatable *@
<link href="~/assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />
<link href="~/assets/layouts/layout4/css/layout.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/layouts/layout4/css/themes/light.min.css" rel="stylesheet" type="text/css" id="style_color" />
<link href="~/assets/layouts/layout4/css/custom.min.css" rel="stylesheet" type="text/css" />
@*datatable *@

<div class="note note-success">
    <p style="color: green;font-size: 20px;"> FOC Claim </p>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject #569450 sbold uppercase">ALL PROJECT</span>
                </div>
            </div>
            <div class="portlet box #E2E8E4">
                <div class="col-lg-12">
                    <div class="col-lg-2"></div>
                    <div class="col-lg-5">
                        @Html.DropDownListFor(model => model.ProjectName, new SelectList(ViewBag.Projects, "Value", "Text"), "SELECT PROJECT", new { @class = "form-control ddChosen dropForProject1 ", id = "dropForProject", style = "text-align: center;" })
                    </div>
                    <div class="col-lg-1"></div>
                    <div class="col-lg-2">
                        <input type="button" id="btnForSearch" class="btn sbold uppercase btn-outline blue" value="Load Project" />
                    </div>
                    <div class="col-lg-2"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-arrow-right font-green-haze"></i>
                    <span class="caption-subject #569450 sbold uppercase">Claim</span>
                </div>
                <div class="tools"> </div>
            </div>
            <div class="portlet box #E2E8E4">
                <div class="portlet-title">
                    <div class="caption" style="color:black">
                        <i class="fa fa-cogs"></i>Raise a claim
                    </div>
                    <div class="tools">
                        <a title="" data-original-title="" href="javascript:;" class="collapse"> </a>
                        <a title="" data-original-title="" href="#portlet-config" data-toggle="modal" class="config"> </a>
                        <a title="" data-original-title="" href="javascript:;" class="reload"> </a>
                        <a title="" data-original-title="" href="javascript:;" class="remove"> </a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="col-lg-12">

                        <div class="col-lg-6">
                            <div class="col-lg-5" style="color: brown;">FOC Claim Date</div>
                            <div class="col-lg-7">
                                @Html.TextBoxFor(model => model.SpareClaimDate, "{0:yyyy-MM-dd}", new { @class = "form-control datepicker spareClaim", id = "spareClaimDate", Type = "text", placeholder = "YYYY-MM-DD", style = "text-align: center;" })
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="col-lg-4" style="color: brown;">  Warehouse Receive Date </div>
                            <div class="col-lg-8">
                                @*@if (ViewBag.ProjectOrders !=null)
                                    {
                                        @Html.DropDownListFor(model => model.OrderNumber, new SelectList(ViewBag.ProjectOrders, "Value", "Text"), "SELECT ORDER", new { @class = "form-control orderNumber", id = "orderNumber", style = "text-align: center;" })

                                    }*@
                                @*@Html.DropDownListFor(model => model.OrderNumber, new SelectList(ViewBag.ProjectOrders1, "Value", "Text"),"SELECT ORDER", new { @class = "form-control orderNumber", id = "orderNumber", style = "text-align: center;" })*@
                                @Html.TextBoxFor(model => model.WarehouseReceiveDate, "{0:yyyy-MM-dd}", new { @class = "form-control datepicker warehouse", id = "warehouseDate", Type = "text", placeholder = "YYYY-MM-DD", style = "text-align: center;" })
                            </div>
                        </div>
                    </div>
                    <br /><br />
                    <div class="col-lg-12">
                        <div class="col-lg-6">
                            <div class="col-lg-5" style="color: brown;">  Quantity</div>
                            <div class="col-lg-7">
                                <input type="number" id="qtyId" class="form-control qty" min="1" value="@Model.Quantity" style="text-align: center;" />
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="col-lg-4" style="color: brown;">Remarks</div>
                            <div class="col-lg-8">
                                @Html.TextAreaFor(model => model.Remarks, new { @class = "form-control remarks", id = "remarksId", Type = "text", style = "text-align: center;" })
                            </div>

                        </div>

                    </div>
                    <br /><br />
                </div>
                <br />


                <div class="row">
                    <div class="col-md-12" style="text-align: center;">
                        <input class="btn sbold uppercase btn-outline blue" type="submit" id="btnSave" value="Save" />
                    </div>
                </div>

            </div>

        </div>
    </div>

</div>


<div class="row">
    <div class="col-md-12">

        <div class="portlet light bordered">

            <div class="portlet box">
                <div class="portlet-title">
                    <div class="caption" style="color:brown;">
                        <i class="fa fa-cogs"></i>Previous FOC Claim Details
                    </div>
                    <div class="tools" style="background-color:#778899;">
                        <a title="" data-original-title="" href="javascript:;" class="collapse"> </a>
                        <a title="" data-original-title="" href="#portlet-config" data-toggle="modal" class="config"> </a>
                        <a title="" data-original-title="" href="javascript:;" class="reload"> </a>
                        <a title="" data-original-title="" href="javascript:;" class="remove"> </a>
                    </div>
                </div>
                <div class="portlet-body">
                    <div class="table-scrollable divTable" id="divTable" style="overflow: auto;">
                        <table id="proSpareTable" class="table table-striped table-scrollable table-bordered table-hover proSpareTable">
                            <thead class="flip-content" style="background-color: #778899;color: white">
                                <tr>
                                    <th style="text-align: center;">ProjectName </th>
                                    <th style="text-align: center;">PoCategory</th>
                                    <th style="text-align: center;">OrderNumber</th>
                                    <th style="text-align: center;">Warehouse <br />Entry Date</th>
                                    <th style="text-align: center;">FOC Claim Date</th>
                                    <th style="text-align: center;">Quantity</th>
                                    <th style="text-align: center;">Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="tBodyForGraph" class="tBodyForGraph"></tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script language="javascript" type="text/javascript">

    $('#btnForSearch').on('click', function () {

        var proSelectId = document.getElementById('dropForProject');
        console.log(proSelectId);
        var proName = proSelectId.options[proSelectId.selectedIndex].text;
        var proId = proSelectId.options[proSelectId.selectedIndex].value;
        console.log(proName);
        console.log(proId);

        if (proName == "SELECT PROJECT") {
            //alert("Please select Project must..........");
            //return false;
            alertify.dialog('alert').set({
                'title': '   ',
                'transition': 'zoom',
                'message': "Please Select Project",
            }).show();
            return false;
        } else {
            @*$.ajax({
                type: 'POST',
                url: '@Url.Action("ProjectWiseOrder", "Commercial")',
                data: "{projectId: '" + proId + "',projectName:'" + proName + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                async: false,
                success: function (data) {
                    console.log(data);
                    $('#orderNumber').empty();
                    $('#orderNumber').append($('<option>', {
                        value: '',
                        text: 'SELECT ORDER'
                    }));
                    var dataList = [];
                    for (var x in data) {
                        dataList = data[x];
                    }
                    var l = dataList.ProjectMasterModels.length;

                    for (var ii = 0; ii < l; ii++) {
                        var text = dataList.ProjectMasterModels[ii].OrderNuber;
                        var val = dataList.ProjectMasterModels[ii].ProjectMasterId;
                        $("#orderNumber").append('<option value=' + val + '>' + text + '</option>');
                    }
                }
            });*@
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetPreviousSpareData", "Commercial")',
                data: "{projectId: '" + proId + "',projectName:'" + proName + "' }",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                async: false,
                success: function (data) {
                    console.log(data);
                    $('#tBodyForGraph').empty();
                    var dataList = [];
                    for (var x in data) {
                        dataList = data[x];
                    }
                    var l = dataList.length;

                    for (var ii = 0; ii < l; ii++) {
                        var body = '<tr>';
                        body += '<td>' + '<p style="text-align: center;">' + dataList[ii].ProjectName + '</p>' + '</td>';
                        body += '<td>' + '<p style="text-align: center;">' + dataList[ii].PoCategory + '</p>' + '</td>';
                        body += '<td>' + '<p style="text-align: center;">' + dataList[ii].OrderNumber + '</p>' + '</td>';
                        //body += '<td>' + '<p style="text-align: center;">' + dataList[ii].ShipmentWithOrder + '</p>' + '</td>';
                        body += '<td>' + '<p style="text-align: center;">' + moment(dataList[ii].WarehouseReceiveDate).format('YYYY-MM-DD') + '</p>' + '</td>';
                        body += '<td>' + '<p style="text-align: center;">' + moment(dataList[ii].SpareClaimDate).format('YYYY-MM-DD') + '</p>' + '</td>';
                        body += '<td>' + '<p style="text-align: center;">' + dataList[ii].Quantity + '</p>' + '</td>';
                        body += '<td>' + '<p style="text-align: center;">' + dataList[ii].Remarks + '</p>' + '</td>';
                        body += '</tr>';

                        $("#proSpareTable tbody").append(body);

                    }

                    $("#proSpareTable").DataTable();
                }

            });
        }

    });

    $("#btnSave").on('click', function (e) {
        e.preventDefault();

        var obj = {};
        var objArr = [];

        var proSelectId = document.getElementById('dropForProject');
        var projectName = proSelectId.options[proSelectId.selectedIndex].text;
        var projectId = proSelectId.options[proSelectId.selectedIndex].value;
        var warehouseDate = $("#warehouseDate").val();
        var spareClaimDate = $('#spareClaimDate').val();
        var quality = $('#qtyId').val();
        var remarks = $('#remarksId').val();


        if (projectName == "SELECT PROJECT") {
            alertify.dialog('alert').set({
                'title': '   ',
                'transition': 'zoom',
                'message': "Please Select Project",
            }).show();
            return false;
        }

        if (warehouseDate == "") {
            alertify.dialog('alert').set({
                'title': '   ',
                'transition': 'zoom',
                'message': "Please Select Warehouse Receive Date",
            }).show();
            return false;
        }

        if (spareClaimDate == "") {
            alertify.dialog('alert').set({
                'title': '   ',
                'transition': 'zoom',
                'message': "Please Select Claim Date",
            }).show();
            return false;
        }
        if (quality == "") {
            alertify.dialog('alert').set({
                'title': '   ',
                'transition': 'zoom',
                'message': "Please Select Quantity",
            }).show();
            return false;
        }
        if (remarks == "") {
            alertify.dialog('alert').set({
                'title': '   ',
                'transition': 'zoom',
                'message': "Please Select Remarks",
            }).show();
            return false;
        }

        obj.ProjectId = projectId;
        obj.ProjectName = projectName;
        obj.WarehouseReceiveDate = warehouseDate;
        obj.SpareClaimDate = spareClaimDate;
        //obj.ShipmentWithOrder = proOrderValue;
        obj.Quantity = quality;
        obj.Remarks = remarks;

        objArr.push(obj);

        $.ajax({
            type: 'POST',
            url: '@Url.Action("SaveSpareClaimData", "Commercial")',
            data: "{objArr:'" + JSON.stringify(objArr) + "'}",
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            async: false,
            success: function (data) {
                console.log("data :" + data);
                var dataList = [];
                for (var x in data) {
                    dataList = data[x];
                }
                console.log(dataList);

                if (dataList == "YES") {
                    alertify.dialog('alert').set({
                        'title': '   ',
                        'transition': 'zoom',
                        'message': "Already Saved.",
                    }).show();
                    return false;
                }
            }

        });
        $('#warehouseDate').val("");
        $('#spareClaimDate').val("");
        $('#qtyId').val("");
        $('#remarksId').val("");
    });

    $('#dropForProject').chosen({
        disable_search_threshold: 10,
        no_results_text: "Oops, nothing found!",
        width: "95%"

    });

    $("#dropForProject").trigger("chosen:updated");

    $('.datepicker').datepicker({
        format: 'yyyy-mm-dd',
        autoclose: 1,
        todayHighlight: true,
    });

    $(document).ready(function () {
        var pId1 = 0;
        var value1;
        var pId;
        var proSelectId = document.getElementById('dropForProject');

        $("#dropForProject option").each(function () {
            value1 = $(this).val();
            pId1 = proSelectId.options[proSelectId.selectedIndex].value;

            if (pId1.length != 0) {

                pId = pId1;

                if (pId != null) {
                    if (value1 == pId) {
                        $("#dropForProject").val(value1);
                    }
                }
            }
        });

    });
</script>

