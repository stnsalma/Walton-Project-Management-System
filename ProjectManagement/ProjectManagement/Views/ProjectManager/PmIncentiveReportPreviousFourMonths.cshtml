@model ProjectManagement.ViewModels.ProjectManager.VmPmIncentivePolicy
@{

    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/icheck/skins/all.css" rel="stylesheet" />
<link href="~/Content/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" />
<script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script src="~/Content/bootstrap-fileinput/bootstrap-fileinput.js"></script>
<script src="~/Content/icheck/icheck.min.js"></script>
<script src="~/Scripts/moment.js"></script>

<script src="~/Content/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
<link href="~/Content/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css" />

@*datatable *@
<link href="~/assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />
<link href="~/assets/layouts/layout4/css/layout.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/layouts/layout4/css/themes/light.min.css" rel="stylesheet" type="text/css" id="style_color" />
<link href="~/assets/layouts/layout4/css/custom.min.css" rel="stylesheet" type="text/css" />
@*datatable *@

<script src="~/Scripts/FileSaver/jquery.wordexport.js"></script>
<script src="~/Scripts/jquery.table2excel.min.js"></script>
<div class="row">
 
    <div class="col-lg-12">
 
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption" style="color: brown;">
                    <span class="caption-subject #569450 sbold uppercase"> PM Team Incentive :</span><span></span>
                    <span class="caption-subject blue">@Request.Params["Name"]</span>
                </div>
                <br/>
                <div class="action col-lg-12">
                    <div class="col-md-2">

                        <button class="btn green btn-outline btn-circle btn-sm pull-left" onclick="tableToExcel('table2excel', '@Request.Params["Name"]')">
                            <i class="fa fa-save"></i>
                            Export to Excel
                        </button>
                    </div>

                    <button class="btn green btn-outline btn-circle btn-sm pull-right pdf" id="pdf">
                        <i class="fa fa-save"></i>
                        Export as PDF
                    </button>
                </div>
                <br />
            </div>
            
            <div class="portlet box" >
                <div class="portlet-title">
                    <div class="caption" style="color:brown;">
                        <i class="fa fa-cogs"></i>Incentive Details of Selected Months
                    </div>
                    <div class="tools" style="background-color:#44B6AE;">
                        <a title="" data-original-title="" href="javascript:;" class="collapse"> </a>
                        <a title="" data-original-title="" href="#portlet-config" data-toggle="modal" class="config"> </a>
                        <a title="" data-original-title="" href="javascript:;" class="reload"> </a>
                        <a title="" data-original-title="" href="javascript:;" class="remove"> </a>
                    </div>
                </div>
                <div class="portlet-body table2excel" id="table2excel">
                    <div class="table-scrollable" style="overflow: auto;" id="PDFWrapper">
                        <table id="incentiveTable" class="table table-striped table-scrollable table-bordered table-hover incentiveTable">
                            <thead class="flip-content" style="background-color:  #44B6AE;color: white">
                                <tr>
                                    <th style="text-align: center;">Model </th>
                                    <th style="text-align: center;">PoCategory</th>
                                    <th style="text-align: center;">PoDate</th>
                                    <th style="text-align: center;">LSD</th>
                                    <th style="text-align: center;">ShipmentTaken</th>
                                    <th style="text-align: center;">EarlierOrLateShipment</th>
                                    <th style="text-align: center;">Others</th>
                                    <th style="text-align: center;">Contribution</th>
                                    <th style="text-align: center;">Month</th>
                                    <th style="text-align: center;">MonNum</th>
                                    <th style="text-align: center;">Amount</th>
                                    <th style="text-align: center;">Remarks</th>
                                    <th style="text-align: center;">Deduction</th>
                                    <th style="text-align: center;">Deduction Remarks</th>
                                    <th style="text-align: center;">Final Amount</th>

                                </tr>
                            </thead>
                            <tbody id="tBodyForIncentive" class="tBodyForIncentive">
                                @foreach (var pmMonthIns in ViewBag.PmMonthWiseIncentive)
                                {
                                    <tr>
                                        <td>
                                            @pmMonthIns.ProjectName

                                        </td>
                                        <td>
                                            @pmMonthIns.PoCategory

                                        </td>
                                        <td>
                                            @if (@pmMonthIns.PoDate != null)
                                            {@String.Format("{0:yyyy-MM-dd}", @pmMonthIns.PoDate)}

                                        </td>
                                        <td>
                                            @if (@pmMonthIns.LSD != null)
                                            {@String.Format("{0:yyyy-MM-dd}", @pmMonthIns.LSD)}


                                        </td>
                                        <td>
                                            @if (@pmMonthIns.ShipmentTaken != null)
                                            {@String.Format("{0:yyyy-MM-dd}", @pmMonthIns.ShipmentTaken)}


                                        </td>
                                        <td>
                                            @pmMonthIns.EarlierOrLateShipment

                                        </td>
                                        <td>
                                            @pmMonthIns.Others

                                        </td>
                                        <td>
                                            @pmMonthIns.PersonNo

                                        </td>
                                        <td>
                                            @pmMonthIns.Month

                                        </td>
                                        <td>
                                            @pmMonthIns.MonNum

                                        </td>
                                        <td>
                                            @pmMonthIns.Amount1

                                        </td>
                                        <td>
                                            @pmMonthIns.Remarks

                                        </td>
                                        <td>
                                            @pmMonthIns.DeductionAmount1

                                        </td>
                                        <td>
                                            @pmMonthIns.D_Remarks

                                        </td>
                                        <td>
                                            @pmMonthIns.FinalAmount1

                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <br/><br/>
    <div class="col-lg-12">
        <div class="col-lg-4">
            <div class="portlet light bordered">
                <div class="portlet-title">
                    <div class="caption" style="color: brown;">
                        <span class="caption-subject #569450 sbold uppercase"> PM Total Incentive</span>
                    </div>
                </div>
                <div class="portlet box">
                    <div class="portlet-title">
                        <div class="caption" style="color:brown;">
                            <i class="fa fa-cogs"></i>Total Incentive Details of Selected Months
                        </div>
                        <div class="tools" style="background-color:#44B6AE;">
                            <a title="" data-original-title="" href="javascript:;" class="collapse"> </a>
                            <a title="" data-original-title="" href="#portlet-config" data-toggle="modal" class="config"> </a>
                            <a title="" data-original-title="" href="javascript:;" class="reload"> </a>
                            <a title="" data-original-title="" href="javascript:;" class="remove"> </a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="table-scrollable" style="overflow: auto;">
                            <table id="totalIncentiveTable" class="table table-striped table-scrollable table-bordered table-hover tbl1">
                                <thead class="flip-content" style="background-color:  #44B6AE;color: white">
                                    <tr>

                                        <th style="text-align: center;width:100px;">Month</th>
                                        <th style="text-align: center;width:100px;">Year</th>
                                        <th style="text-align: center;width:100px;">Final Amount</th>
                                    </tr>
                                </thead>
                                <tbody id="tBodyTotalIncentive" class="tBodyTotalIncentive">
                                    @foreach (var pmTotalIns in ViewBag.PmTotalIncentive)
                                    {
                                        <tr>
                                            <td style="text-align: center;">
                                                @pmTotalIns.Month

                                            </td>
                                            <td style="text-align: center;">
                                                @pmTotalIns.Year

                                            </td>
                                            <td style="text-align: center;">
                                                @pmTotalIns.TotalIncentive1
                                            </td>

                                        </tr>
                                    }
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4"></div>

        <div class="col-lg-4"></div>
    </div>
</div>


<script>

        $(document).ready(function () {
            $('#incentiveTable').DataTable({
                "order": [[9, "asc"]]
            });
        });
        
        $("#pdf").on("click", function () {
            var divContents = $("#PDFWrapper").html();
            var printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<html><head><title></title>');
            printWindow.document.write('</head><body >');
            printWindow.document.write(divContents);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        });
        var tableToExcel = (function () {
            var uri = 'data:application/vnd.ms-excel;base64,'
              , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
              , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
              , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }

            return function (table, name) {
                if (!table.nodeType) table = document.getElementById(table)
                var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
                //window.location.href = uri + base64(format(template, ctx))
                var link = document.createElement("a");
                link.download = '@Request.Params["Name"]' + '_'  + '@Request.Params["YearName"]' + '.xls';
                link.href = uri + base64(format(template, ctx));
                link.click();
            }
        })()

    </script>
@*datatable*@
<script src="~/assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="~/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script src="~/assets/pages/scripts/table-datatables-rowreorder.min.js" type="text/javascript"></script>
@*datatable*@
