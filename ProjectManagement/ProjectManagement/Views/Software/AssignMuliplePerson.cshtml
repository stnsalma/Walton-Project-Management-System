@using ProjectManagement.Models
@model ProjectManagement.ViewModels.Software.AssignMuliplePersonViewModel

<link href="~/assets/global/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />
<link href="~/assets/layouts/layout4/css/layout.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/layouts/layout4/css/themes/light.min.css" rel="stylesheet" type="text/css" id="style_color" />
<link href="~/assets/layouts/layout4/css/custom.min.css" rel="stylesheet" type="text/css" />

<style>
    .page-header-fixed .page-container {
        margin-top: 0px;
    }

    .navbar-fixed-top {
        position: relative;
    }
     #loading {
         width: 100%;
         height: 100%;
         top: 70px;
         left: 0;
         position: fixed;
         display: block;
         opacity: 0.7;
         background-color: #fff;
         z-index: 999;
         text-align: center;
     }
</style>
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN EXAMPLE TABLE PORTLET-->
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="col-lg-12">
                    <div class="caption font-dark">
                        <i class="icon-settings font-dark"></i>
                        <span class="caption-subject bold uppercase">  List of Projects from Project Manager</span>
                    </div>
                    <div class="tools"> </div>
                </div>
                <br /><br />
                <div class="col-lg-12">
                    <div class="col-lg-9">
                        <p style="color:red;font-weight: bold" class="col-md-2">Welcome<h1 style="color:darkgoldenrod;font-weight: bold">@ViewBag.UserInfo.UserFullName !!</h1></p>
                    </div>
                    <div class="col-lg-3"></div>
                </div>
            </div>
            <div class="portlet-body">
                <div class="table-scrollable table-responsive">
                    <table class="table table-bordered table-striped table-condensed flip-content tbl" id="tbl">
                        <thead style="background-color: #4a8099;color: white;">
                            <tr>
                                <th class="text-center" style="display: none;"> ProjectMasterId </th>
                                <th class="text-center"> Project Name </th>
                                <th class="text-center">Project Type</th>
                                <th class="text-center">Po<br />Category</th>
                                <th class="text-center" style="display: none">Assign <br />UserID</th>
                                <th class="text-center">Assign <br />UserName</th>
                                <th class="text-center" style="display: none">Assign Date</th>
                                <th class="text-center" style="display: none">PMassign_Id</th>
                                <th class="text-center" style="display: none">PM_Id</th>
                                <th class="text-center">PM Name</th>
                                <th class="text-center">PM Remarks</th>
                                <th class="text-center">Test Phase</th>
                                <th class="text-center">Categories</th>
                                <th class="text-center">Sw_Version<br /> Name</th>
                                <th class="text-center">Sw_ Version <br />Number</th>
                                <th class="text-center">Project <br />Assign <br />Time</th>
                                <th class="text-center" style="display: none;">SwQcInAsgn <br />ID</th>
                                <th class="text-center" style="display: none;">SwQcIn_Name</th>
                                <th class="text-center">Details</th>
                                <th class="text-center">Assign <br />Single/Multiple</th>

                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.PmQcAssignModels)
                            {
                            <tr class="forAssignToQc odd gradeX">
                                @*<tr class="forAssignToQc">*@
                                <td class="text-center" style="display: none">
                                    @item.ProjectMasterId
                                </td>
                                <td class="text-center">@item.ProjectName</td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.ProjectType)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.SourcingType)
                                </td>
                                <td class="text-center" style="display: none">
                                    @Html.DisplayFor(modelItem => item.AssignUserId)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.AssignUserName)
                                </td>
                                <td class="text-center" style="display: none">
                                    @Html.DisplayFor(modelItem => item.PmToQcHeadAssignTime)
                                </td>

                                <td class="text-center" style="display: none">
                                    @item.ProjectPmAssignId
                                </td>
                                <td class="text-center" style="display: none">
                                    @Html.DisplayFor(modelItem => item.ProjectManagerUserId)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.ProjectManagerUserName)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.PmToQcHeadAssignComment)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.TestPhaseName)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.AccessoriesTestType)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.SoftwareVersionName)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.SoftwareVersionNo)
                                </td>
                                <td class="text-center">
                                    @Html.DisplayFor(modelItem => item.PmToQcHeadAssignTime)
                                </td>

                                <td class="text-center" style="display: none;">

                                    @item.SwQcHeadAssignId
                                </td>

                                <td class="text-center" style="display: none;">
                                    @Html.DisplayFor(modelItem => item.QcInchargeUserName)
                                </td>

                                <td class="text-center">
                                    OS: @Html.DisplayFor(modelItem => item.OsName) - @Html.DisplayFor(modelItem => item.OsVersion)

                                    <br />
                                    <a id="popoverOption" class="btn btn-circle popoverOption" style="font-weight: bolder;z-index: 100;" data-content="Display: @Html.DisplayFor(modelItem => item.DisplaySize), Display Name: @Html.DisplayFor(modelItem => item.DisplayName), Processor: @Html.DisplayFor(modelItem => item.ProcessorName), Clock: @Html.DisplayFor(modelItem => item.ProcessorClock), Chipset: @Html.DisplayFor(modelitem => item.Chipset), Front_Camera: @Html.DisplayFor(modelitem => item.FrontCamera), Back_Camera: @Html.DisplayFor(modelitem => item.BackCamera), RAM: @Html.DisplayFor(modelitem => item.Ram), ROM: @Html.DisplayFor(modelitem => item.Rom), Battery: @Html.DisplayFor(modelitem => item.Battery), Number Of Sample: @Html.DisplayFor(modelitem => item.ProjectManagerSampleNo)" rel="popover" data-placement="bottom" data-original-title="@item.ProjectName">
                                        <span class="glyphicon glyphicon-list-alt"></span> Details
                                    </a>
                                </td>
                                <td class="text-center">

                                    <button type="button" class="btn btn-danger btnOpenModal">
                                        <span class="glyphicon glyphicon-plus"></span> Assign
                                    </button>

                                </td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
                @*<br /><br /><br />
                    <div class="rvmCls" style="margin-left: 5px;">
                        @Html.ActionLink("Back to Dashboard", "SwQcInchargeDashboard")
                    </div>*@
            </div>
        </div>

    </div>

</div>

<div id="loading" style="display: none;text-align: center;">
    <img src="~/img/loading-spinner-grey.gif" />
</div>

<div class="modal fade " id="draggable" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title" style="font-weight: bold;color: black;">Assign</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">Project Name :</label>
                        <input name="ProjectName" id="ProjectName" disabled="disabled" type="text" class="form-control">
                    </div>
                    <div class="form-group" style="display: none;">
                        <label class="control-label">Project ID :</label>
                        <input name="ProjectMasterId" id="ProjectMasterId" type="text" class="form-control">
                    </div>
                    <div class="form-group" style="display: none;">
                        <label class="control-label">SwQcInchargeAssignId</label>
                        <input name="SwQcInchargeAssignId" id="SwQcInchargeAssignId" type="text" class="form-control">
                    </div>
                    <div class="form-group" style="display: none;">
                        <label class="control-label">ProjectPmAssignId</label>
                        <input name="ProjectPmAssignId" id="ProjectPmAssignId" type="text" class="form-control">
                    </div>
                    <div class="form-group" style="display: none;">
                        <label class="control-label">AccessoriesTestType</label>
                        <input name="AccessoriesTestType" id="AccessoriesTestType" type="text" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">Comment :</label>
                        <textarea name="SwInchargeAssignToQcComment" id="SwInchargeAssignToQcComment" class="form-control" id="message-text"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="multiple" class="control-label">Assign QCs :</label>
                        <select name="multiple" id="multiple" class="form-control ddChosen" multiple>
                            @foreach (CmnUserModel item in Model.ddlAssignUsersList)
                            {
                                <option value="@item.CmnUserId">
                                    @item.UserFullName _ @item.EmployeeCode
                                </option>
                            }

                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">Approx. QC completion Time</label>
                        <input class="form-control" name="ApproxInchargeToQcDeliveryDate" id="ApproxInchargeToQcDeliveryDate" type="text" placeholder="yyyy-mm-dd">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
                <input type="submit" id="smitModalOfSave" class="btn green smitModalOfSave" value="Save changes" />
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<div class="portlet box red">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-picture"></i>Select necessary project for forwarding issue to 2nd version from 1st version
        </div>
    </div>
    <div class="portlet-body " style="display: block;">
        <div class="row">
            @if (ViewBag.CombinedIds != null)
            {
                <div class="col-lg-12">
                    <div class="col-lg-6">
                        <div class="col-lg-3" style="text-align: right">
                            Select Project
                        </div>
                        <div class="col-lg-9" style="text-align: left">
                            @Html.DropDownListFor(model => model.ProjectName, new SelectList(ViewBag.CombinedIds, "Value", "Text"), new { @class = "form-control ddChosen", @id = "proName" })
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="col-lg-3"> </div>
                        <div class="form-actions">
                            <input type="button" id="btnforname" class="btn sbold uppercase btn-outline red" value="PROCESS"/>
                        </div>
                        <div class="col-lg-3"> </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
<style>
    .hiddenColumn {
        display: none;
    }

    .popover-title {
        /*background: #428bca;*/
        background: darkgrey;
        color: white;
    }
</style>
@*<div id="divResponse" style="display: none;"></div>*@
<script type="text/javascript">
    $(function () {
        $("body:first").addClass("page-sidebar-closed");
        $("ul.page-sidebar-menu").addClass("page-sidebar-menu-closed");
    });
    $('#tbl').DataTable();
    //$('.tbl').DataTable({
    //    "scrollX": true,
    //    "scrollY": 500,
    //    "paging": false,

    //});
    $(function () {
        var currentRow;
        var date = new Date();
        var today = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        $('#ApproxInchargeToQcDeliveryDate').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            //startDate: today,
            //endDate: 0
        });

        $('#multiple').chosen({
            disable_search_threshold: 10,
            no_results_text: "Oops, nothing found!",
            width: "95%"
        });
        $('#tbl').on('click', '.btnOpenModal', function () {
            // $('.btnOpenModal').on('click', function (e) {
            // e.preventDefault();

            var rowIndex = $(this).closest('tr').index() + 1;
            var table = document.getElementById('tbl');
            var projectName = $.trim(table.rows[rowIndex].cells[1].innerHTML);
            var swQcInchargeAssignId = $.trim(table.rows[rowIndex].cells[16].innerHTML);//$(this).parents('tr').find('input:hidden[id=SwQcInchargeAssignId]').val();
            var projectMasterId = $.trim(table.rows[rowIndex].cells[0].innerHTML);//$(this).parents('tr').find('input:hidden[id=ProjectMasterId]').val();
            var projectPmAssignId = $.trim(table.rows[rowIndex].cells[7].innerHTML);// $(this).parents('tr').find('input:hidden[id=ProjectPmAssignId]').val();
            var accessoriesTestType = $.trim(table.rows[rowIndex].cells[12].innerHTML);// $(this).parents('tr').find('input:hidden[id=ProjectPmAssignId]').val();

            $('#draggable').modal();

            $('#ProjectName').val(projectName);
            $('#ProjectMasterId').val(projectMasterId);
            $('#ProjectPmAssignId').val(projectPmAssignId);
            $('#SwQcInchargeAssignId').val(swQcInchargeAssignId);
            $('#AccessoriesTestType').val(accessoriesTestType);

            currentRow = $(this).closest('tr');

            console.log("projectMasterId  :" + projectMasterId);
            console.log("projectName  :" + projectName);
            console.log("projectPmAssignId  :" + projectPmAssignId);
            console.log("swQcInchargeAssignId  :" + swQcInchargeAssignId);
        });

        $('.smitModalOfSave').on('click', function () {

            $('#draggable').modal('hide');

            var proId;
            var proName;
            var projectPmAssignId;
            var swQcInchargeAssignId;
            var swQcheadCom;
            var swAssignPeople;
            var swAproDate;
            var accessoriesTestType;
            
            
            var obj = {};

            var rowIndex = $(this).closest('tr').index() + 1;
            var table = document.getElementById('tbl');

            proName = $('#ProjectName').val();
            swQcInchargeAssignId = $('#SwQcInchargeAssignId').val();
            proId = $('#ProjectMasterId').val();
            projectPmAssignId = $('#ProjectPmAssignId').val();
            swQcheadCom = $("#SwInchargeAssignToQcComment").val().trim();
            swAssignPeople = $('#multiple').val();
            accessoriesTestType = $('#AccessoriesTestType').val();

            if (swAssignPeople == "" || swAssignPeople == null) {
                $('#draggable').modal('hide');
                alertify.dialog('alert').set({
                    'title': '   ',
                    'transition': 'zoom',
                    'message': "Please must Select Assign QCs.",
                }).show();
                return false;
            }

            swAproDate = $('#ApproxInchargeToQcDeliveryDate').val();

            if (swAproDate == "" || swAproDate == null) {
                $('#draggable').modal('hide');
                alertify.dialog('alert').set({
                    'title': '   ',
                    'transition': 'zoom',
                    'message': "Please must Select Approx. QC completion Time.",
                }).show();
                return false;
            }

            console.log("all ids :" + proId + proName + projectPmAssignId + swQcInchargeAssignId + swQcheadCom + swAssignPeople + swAssignPeople + swAproDate);
            $('#loading').show();
            obj.ProjectMasterId = proId;
            obj.ProjectName = proName;
            obj.ProjectPmAssignId = projectPmAssignId;
            obj.SwQcInchargeAssignId = swQcInchargeAssignId;
            obj.SwInchargeAssignToQcComment = swQcheadCom;
            obj.multiple = swAssignPeople;
            obj.ApproxInchargeToQcDeliveryDate = swAproDate;
            obj.AccessoriesTestType = accessoriesTestType;

            $.ajax({
                url: '@Url.Action("AssignMuliplePerson", "Software")',
                type: 'POST',
                data: JSON.stringify(obj),
                dataType: "json",
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    console.log("data :" + data);

                    if (data == "ok") {

                        $('#SwInchargeAssignToQcComment').val('');
                        $('#ApproxInchargeToQcDeliveryDate').val('');
                        $('#multiple').val('');

                        window.location = '@Url.Action("AssignMuliplePerson", "Software")';
                        window.location.reload(true);
                        $('#loading').hide();
                    }
                }
            });

            event.preventDefault(); //Prevent the default submit
        });

        $('.popoverOption').popover({ trigger: "click" });

        $('#btnforname').on('click', function (e) {
            e.preventDefault();
            $('#loading').show();
            
            var proSelectId = document.getElementById('proName');
            console.log(proSelectId);
            var ProjectName = proSelectId.options[proSelectId.selectedIndex].text;
            var selecteddropValue = proSelectId.options[proSelectId.selectedIndex].value;
          
            var obj = {};
            var objArr = [];
            obj.ProjectName = ProjectName;
            objArr.push(obj);
            $('#loading').show();
            $.ajax({
                type: "POST",
                url: '@Url.Action("ForwardFirstVersionIssueToSecondVersion", "Software")',
                data: "{objArr:'" + JSON.stringify(objArr) + "'}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                async: false,
                success: function (data) {
                    if (data == "OK") {
                        window.location = '@Url.Action("AssignMuliplePerson", "Software")';
                        window.location.reload(true);
                        $('#loading').hide();
                    }
                }
            });

        });
    });
</script>

<script src="~/assets/global/scripts/datatable.js" type="text/javascript"></script>
<script src="~/assets/global/plugins/datatables/datatables.min.js" type="text/javascript"></script>
<script src="~/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js" type="text/javascript"></script>
<script src="~/assets/pages/scripts/table-datatables-rowreorder.min.js" type="text/javascript"></script>